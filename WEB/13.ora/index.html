<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <title>Document</title>
    <script>
        /*Minden idők 100 legjobb klasszikus könyvét bemutató weboldalon legyenek statikus elemek is.(sztroi, egyéb tartalom..)
        100 könyv adatainak elérése (válasz másik módot, a múlt óraitól eltérő módon jelenjenek meg az adatok)
        Adathalmaz rendezése (a lapok száma szerint, és vagy megjelenés éve szerint)
        Keresés (nyelv szerint, szerző szerint, cím szerint)
        Új könyv hozzáadása, törlés, módosítás funkciókat valósítsd meg. 
        Lehet bootstrap, w3, vagy saját stílus vagy ezek kombinációja.*/
        class Konyv {
            constructor(id, author, country, imagelink, language, link, pages, title, year) {
                this.id = id;
                this.author = author;
                this.country = country;
                this.imagelink = imagelink;
                this.language = language;
                this.link = link;
                this.pages = pages;
                this.title = title;
                this.year = year;
            }
        }

        var konyvek = [];
        var authors = [];
        var languages = [];
        var titles = [];
        var id = 0;
        var bookCount;
        var cardlist;
        //Új könyv változók
        var author;
        var country;
        var imagelink;
        var language;
        var link;
        var pages;
        var title;
        var year;
        var newBook;
        //Módosítás
        var cauthor;
        var ccountry;
        var cimagelink;
        var clanguage;
        var clink;
        var cpages;
        var ctitle;
        var cyear;

        //var pattern = "https(:){1}//raw(.){1}githubusercontent(.){1}com(/){1}benoitvallon(/){1}100-best-books(/){1}master(/){1}static(/){1}images(/){1}[a-zA-Z0-9\-\]{1,254}.jpg";
        var pattern = "images(/){1}[a-zA-Z0-9\-\]{1,254}.jpg";
        window.onload = function () {
            fetch("https://raw.githubusercontent.com/benoitvallon/100-best-books/master/books.json")
                .then((response) => response.json())
                .then((json) => {
                    json.forEach(element => {
                        konyvek.push(new Konyv(id, element["author"], element["country"], element["imageLink"], element["language"], element["link"], element["pages"], element["title"], element["year"]));
                        id++;

                        if (!authors.includes(element["author"])) {
                            authors.push(element["author"]);
                        }
                        if (!languages.includes(element["language"])) {
                            languages.push(element["language"]);
                        }
                        if (!titles.includes(element["title"])) {
                            titles.push(element["title"]);
                        }
                    });
                    bookCount = konyvek.length;
                    createCards(konyvek);
                    console.log("Újra lett generálva minden... sajna");
                });
            //author, country, imagelink, language, link, pages, title, year
            author = document.getElementById("new-author");
            author.value = "Putyin";
            country = document.getElementById("new-country");
            country.value = "Oroszország";
            imagelink = document.getElementById("new-imagelink");
            imagelink.value = "https://image.cnbcfm.com/api/v1/image/107170422-16717337232022-12-22t182143z_934003418_rc25by9yeknw_rtrmadp_0_ukraine-crisis-russia-putin.jpeg?v=1673966428";
            language = document.getElementById("new-langauage");
            language.value = "Orosz";
            link = document.getElementById("new-link");
            link.value = "www.google.ru";
            pages = document.getElementById("new-pages");
            pages.value = "60000";
            title = document.getElementById("new-title");
            title.value = "A nép szava";
            year = document.getElementById("new-year");
            year.value = "2024";

        }
        //Kártyák létrehozás
        function createCards(array) {
            cardlist = document.getElementById("card-list");
            cardlist.innerHTML = "";
            for (let i = 0; i < array.length; i++) {
                if (array[i] != undefined) {
                    const konyv = array[i];
                    const srcImg = konyv.imagelink.match(pattern) ? `${"https://raw.githubusercontent.com/benoitvallon/100-best-books/master/static/images/" + konyv.imagelink.split('/')[1]}` : konyv.imagelink;
                    cardlist.innerHTML +=
                        `<div id="${konyv.id}" class="col">
                            <div class="card h-100">
                            <img style="height: 75%;" src="${srcImg}" class="card-img-top"> 
                        <div class="card-body">
                            <h5 class="card-title">${konyv.author}</h5>
                            <p class="card-text">${konyv.title}</p>
                            <p class="card-text"><small class="text-muted">Megjelenés: ${konyv.year}</small></p>

                            <!-- Módosítás -->
                            <button id="${konyv.id}" onclick="loadChangeValues()" data-bs-toggle="modal" data-bs-target="#cardChange-${konyv.id}" class="btn btn-warning">Módosítás</button>

                            <div class="modal fade" id="cardChange-${konyv.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Módosítás</h5>
                                </div>
                                <div class="modal-body">
                                    <form>
                                    <div class="form-group">
                                        <!--Szerző-->
                                        <label for="cnew-author-cardChange-${konyv.id}" class="col-form-label">Szerző:</label>
                                        <input id="cnew-author-cardChange-${konyv.id}" type="text" class="form-control">
                                        <!--Ország-->
                                        <label for="cnew-country-cardChange-${konyv.id}" class="col-form-label">Ország:</label>
                                        <input id="cnew-country-cardChange-${konyv.id}" type="text" class="form-control" id="recipient-name">
                                        <!--Borítókép-->
                                        <label for="cnew-imagelink-cardChange-${konyv.id}" class="col-form-label">Borítókép(.png/.jpg link):</label>
                                        <input id="cnew-imagelink-cardChange-${konyv.id}" type="text" class="form-control" id="recipient-name">
                                        <!--Nyelv-->
                                        <label for="cnew-langauage-cardChange-${konyv.id}" class="col-form-label">Nyelv:</label>
                                        <input id="cnew-langauage-cardChange-${konyv.id}" type="text" class="form-control"  id="recipient-name">
                                        <!--Információ-->
                                        <label for="cnew-link-cardChange-${konyv.id}" class="col-form-label">Információs link(wiki):</label>
                                        <input id="cnew-link-cardChange-${konyv.id}" type="text" class="form-control"id="recipient-name">
                                        <!--Oldalszám-->
                                        <label for="cnew-pages-cardChange-${konyv.id}" class="col-form-label">Oldalszám:</label>
                                        <input id="cnew-pages-cardChange-${konyv.id}" type="text" class="form-control"id="recipient-name">
                                        <!--Címe-->
                                        <label for="cnew-title-cardChange-${konyv.id}" class="col-form-label">Címe:</label>
                                        <input id="cnew-title-cardChange-${konyv.id}" type="text" class="form-control" id="recipient-name">
                                        <!--Megjelenés éve-->
                                        <label for="cnew-year-cardChange-${konyv.id}" class="col-form-label">Megjelenés éve:</label>
                                        <input id="cnew-year-cardChange-${konyv.id}" type="text" class="form-control"id="recipient-name">
                                    </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégsem</button>
                                    <button id="${konyv.id}" onclick="changeBook()" type="button" class="btn btn-success" data-bs-dismiss="modal">Módosítás mentése</button>
                                </div>
                                </div>
                            </div>
                            </div>

                            <!-- Törlés -->
                            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#cardRemove-${konyv.id}">Törlés</button>

                            <!-- Kártya törlés megerősítés ablak -->
                            <div class="modal fade" id="cardRemove-${konyv.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Törlés megerősítése</h5>
                                </div>
                                <div class="modal-body">Biztosan törölni szeretnéd az adott elemet?</div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégsem</button>
                                    <button id="${konyv.id}" onclick="removeBook()" type="button" class="btn btn-danger" data-bs-dismiss="modal">Törlés</button>
                                </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                    </div>`
                }
            }
        }
        //sort
        function sortBooks(type) {
            var sorted = [];
            if (type == "year") {
                sorted = konyvek.sort((a, b) => a.year > b.year ? 0 : -1);
            } else if (type == "pages") {
                sorted = konyvek.sort((a, b) => a.pages > b.pages ? 0 : -1);
            }
        }
        //Keresés (nyelv szerint, szerző szerint, cím szerint)
        function searchBooks() {
            var search_input = document.getElementById("searchInput");
            var conditions = search_input.value.split(',');
            if (conditions.length == 1 && conditions[0] == '') { return createCards(konyvek); }
            console.log(conditions.length)
            console.log(conditions)
            var searched = []
            conditions.forEach(element => {
                if (authors.includes(element) || languages.includes(element) || titles.includes(element)) {
                    konyvek.forEach(konyv => {
                        if (konyv.author.includes(element) || konyv.language.includes(element) || konyv.title.includes(element)) {
                            if (!searched.includes(konyv)) {
                                searched.push(konyv);
                            }
                        }
                    });
                }
            });
            createCards(searched);
        }
        var vane = false;
        function ArrayContainsBook(array, konyv) {
            array.forEach(ko => {
                if (ko.author == konyv.author &&
                    ko.country == konyv.country &&
                    ko.title == konyv.title) {
                    vane = true;
                }
            });
            return vane;
        }
        //Új könyv hozzáadás
        function addBook() {
            newBook = new Konyv(id, author.value, country.value, imagelink.value, language.value, link.value, pages.value, title.value, year.value);
            if (!ArrayContainsBook(konyvek, newBook)) {
                konyvek.push(newBook);
                id++;
                createCards(konyvek);
            }
        }
        //Könyv törlése
        function removeBook() {
            var book = document.getElementById(event.target.id);
            konyvek.forEach(konyv => {
                if (konyv.id != null) {
                    if (book.id == konyv.id) {
                        delete konyvek[konyvek.indexOf(konyv)];
                        bookCount--;
                        createCards(konyvek);
                    }
                }
            });
        }
        //Módosítás változók betöltése
        function loadChangeValues() {
            var id = event.target.id;
            cauthor = document.getElementById("cnew-author-cardChange-"+id);
            cauthor.value = konyvek[id].author;
            ccountry = document.getElementById("cnew-country-cardChange-"+id);
            ccountry.value = konyvek[id].ccountry;
            cimagelink = document.getElementById("cnew-imagelink-cardChange-"+id);
            cimagelink.value = konyvek[id].imagelink;
            clanguage = document.getElementById("cnew-langauage-cardChange-"+id);
            clanguage.value = konyvek[id].language;
            clink = document.getElementById("cnew-link-cardChange-"+id);
            clink.value = konyvek[id].link;
            cpages = document.getElementById("cnew-pages-cardChange-"+id);
            cpages.value = konyvek[id].pages;
            ctitle = document.getElementById("cnew-title-cardChange-"+id);
            ctitle.value = konyvek[id].title;
            cyear = document.getElementById("cnew-year-cardChange-"+id);
            cyear.value = konyvek[id].year;
        }
        //Könyv módosítás
        function changeBook() {
            var changeBook = document.getElementById(event.target.id);
            if (ArrayContainsBook(konyvek, konyvek[changeBook.id])) {
                konyvek[changeBook.id].author = cauthor.value;
                konyvek[changeBook.id].country = ccountry.value;
                konyvek[changeBook.id].imagelink = cimagelink.value;
                konyvek[changeBook.id].language = clanguage.value;
                konyvek[changeBook.id].link = clink.value;
                konyvek[changeBook.id].pages = cpages.value;
                konyvek[changeBook.id].title = ctitle.value;
                konyvek[changeBook.id].year = cyear.value;
                createCards(konyvek);
            }
            console.log(ArrayContainsBook(konyvek, konyvek[changeBook.id]))
            console.log(changeBook.id);
        }


    </script>
    <style>
        .bg-color {
            background-color: #ffe6cc;
        }
    </style>
</head>

<body class="bg-color">
    <nav class="navbar navbar-expand-lg bg-secondary">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link text-warning" href="index.html">Főoldal</a>
                    </li>
                    <li class="nav-item">
                        <a data-bs-toggle="modal" data-bs-target="#newBook" class="nav-link text-warning" href="#">Új
                            könyv</a>
                        <div class="modal fade" id="newBook" tabindex="-1" role="dialog"
                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Új könyv hozzáadása</h5>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                            <div class="form-group">
                                                <!--Szerző-->
                                                <label for="new-author" class="col-form-label">Szerző:</label>
                                                <input id="new-author" type="text" class="form-control">
                                                <!--Ország-->
                                                <label for="new-country" class="col-form-label">Ország:</label>
                                                <input id="new-country" type="text" class="form-control"
                                                    id="recipient-name">
                                                <!--Borítókép-->
                                                <label for="new-imagelink" class="col-form-label">Borítókép(.png/.jpg
                                                    link):</label>
                                                <input id="new-imagelink" type="text" class="form-control"
                                                    id="recipient-name">
                                                <!--Nyelv-->
                                                <label for="new-langauage" class="col-form-label">Nyelv:</label>
                                                <input id="new-langauage" type="text" class="form-control"
                                                    id="recipient-name">
                                                <!--Információ-->
                                                <label for="new-link" class="col-form-label">Információs
                                                    link(wiki):</label>
                                                <input id="new-link" type="text" class="form-control"
                                                    id="recipient-name">
                                                <!--Oldalszám-->
                                                <label for="new-pages" class="col-form-label">Oldalszám:</label>
                                                <input id="new-pages" type="text" class="form-control"
                                                    id="recipient-name">
                                                <!--Címe-->
                                                <label for="new-title" class="col-form-label">Címe:</label>
                                                <input id="new-title" type="text" class="form-control"
                                                    id="recipient-name">
                                                <!--Megjelenés éve-->
                                                <label for="new-year" class="col-form-label">Megjelenés éve:</label>
                                                <input id="new-year" type="text" class="form-control"
                                                    id="recipient-name">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-warning"
                                            data-bs-dismiss="modal">Mégsem</button>
                                        <button onclick="addBook()" type="button" class="btn btn-success"
                                            data-bs-dismiss="modal">Hozzáadás</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <input id="searchInput" class="form-control me-2" type="search" placeholder="Keresés"
                        aria-label="Search">
                    <button onclick="searchBooks()" class="btn btn-outline-warning" type="button">Keresés</button>
                </form>
            </div>
        </div>
    </nav>

    <br>

    <div class="container">
        <div id="card-list" class="row row-cols-1 row-cols-md-3 g-4"></div>
        <br>
    </div>
    </div>
</body>

</html>