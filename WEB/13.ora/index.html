<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <title>Document</title>
    <script>
        /*Minden idők 100 legjobb klasszikus könyvét bemutató weboldalon legyenek statikus elemek is.(sztroi, egyéb tartalom..)
        100 könyv adatainak elérése (válasz másik módot, a múlt óraitól eltérő módon jelenjenek meg az adatok)
        Adathalmaz rendezése (a lapok száma szerint, és vagy megjelenés éve szerint)
        Keresés (nyelv szerint, szerző szerint, cím szerint)
        Új könyv hozzáadása, törlés, módosítás funkciókat valósítsd meg. 
        Lehet bootstrap, w3, vagy saját stílus vagy ezek kombinációja.*/
        class Konyv {
            constructor(id, author, country, imagelink, language, link, pages, title, year) {
                this.id = id;
                this.author = author;
                this.country = country;
                this.imagelink = imagelink;
                this.language = language;
                this.link = link;
                this.pages = pages;
                this.title = title;
                this.year = year;
            }
        }

        var konyvek = [];
        var authors = [];
        var languages = [];
        var titles = [];
        var id = 0;
        var bookCount;
        var cardlist; 

        window.onload = function () {
            fetch("https://raw.githubusercontent.com/benoitvallon/100-best-books/master/books.json")
                .then((response) => response.json())
                .then((json) => {
                    json.forEach(element => {
                        konyvek.push(new Konyv(id, element["author"], element["country"], element["imageLink"], element["language"], element["link"], element["pages"], element["title"], element["year"]));
                        id++;

                        if (!authors.includes(element["author"])) {
                            authors.push(element["author"]);
                        }
                        if (!languages.includes(element["language"])) {
                            languages.push(element["language"]);
                        }
                        if (!titles.includes(element["title"])) {
                            titles.push(element["title"]);
                        }
                    });
                    bookCount = konyvek.length;
                    createCards(konyvek.length);
                    console.log("Újra lett generálva minden... sajna");
                });
        }
        //Kártyák létrehozás
        function createCards() {
            cardlist = document.getElementById("card-list");
            cardlist.innerHTML = "";
            for (let i = 0; i < konyvek.length; i++) {
                if (konyvek[i] != undefined) {
                    const konyv = konyvek[i];

                    cardlist.innerHTML +=
                        `<div id="${konyv.id}" class="col">
                    <div class="card h-100">
                        <img style="height: 75%;" src="${"https://raw.githubusercontent.com/benoitvallon/100-best-books/master/static/images/" + konyv.imagelink.split('/')[1]}"
                            class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title">${konyv.author}</h5>
                            <p class="card-text">${konyv.title}</p>
                            <p class="card-text"><small class="text-muted">Megjelenés: ${konyv.year}</small></p>

                            <!-- Módosítás -->
                            <button data-bs-toggle="modal" data-bs-target="#cardChange-${konyv.id}" class="btn btn-warning" onclick="changeBook(${konyv.id})">Módosítás</button>

                            <div class="modal fade" id="cardChange-${konyv.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">New message</h5>
                                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                    <div class="form-group">
                                        <label for="recipient-name" class="col-form-label">Recipient:</label>
                                        <input type="text" class="form-control" id="recipient-name">
                                    </div>
                                    <div class="form-group">
                                        <label for="message-text" class="col-form-label">Message:</label>
                                    </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégsem</button>
                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Send message</button>
                                </div>
                                </div>
                            </div>
                            </div>

                            <!-- Törlés -->
                            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#cardRemove-${konyv.id}">Törlés</button>

                            <!-- Kártya törlés megerősítés ablak -->
                            <div class="modal fade" id="cardRemove-${konyv.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Törlés megerősítése</h5>
                                </div>
                                <div class="modal-body">Biztosan törölni szeretnéd az adott elemet?</div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégsem</button>
                                    <button id="${konyv.id}" onclick="removeBook()" type="button" class="btn btn-danger" data-bs-dismiss="modal">Törlés</button>
                                </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                    </div>`
                }
            }
        }

        //sort
        function sortBooks(type) {
            var sorted = [];
            if (type == "year") {
                console.log("Év szerint sort!")
                sorted = konyvek.sort((a, b) => a.year > b.year ? 0 : -1);
            } else if (type == "pages") {
                console.log("Oldalak szerint sort!")
                sorted = konyvek.sort((a, b) => a.pages > b.pages ? 0 : -1);
            }
            console.log(`${konyvek[0].author}, ${konyvek[1].title}`);
        }

        //Keresés (nyelv szerint, szerző szerint, cím szerint)
        function searchBooks() {
            var search_input = document.getElementById("searchInput");
            var conditions = search_input.value.split(',');
            var searched = []
            conditions.forEach(element => {
                if (authors.includes(element) || languages.includes(element) || titles.includes(element)) {
                    konyvek.forEach(konyv => {
                        if (konyv.author == element || konyv.language == element || konyv.title == element) {
                            if (!searched.includes(konyv)) {
                                searched.push(konyv);
                            }
                        }
                    });
                }
            });
        }

        function addBook() {
            //author, country, imagelink, language, link, pages, title, year
            var author = document.getElementById("new-author");
            var country = document.getElementById("new-country");
            var imageLink = document.getElementById("new-imagelink");
            var language = document.getElementById("new-langauage");
            var link = document.getElementById("new-link");
            var pages = document.getElementById("new-pages");
            var title = document.getElementById("new-title");
            var year = document.getElementById("new-year");

            var newBook = new Konyv(author.value, country.value, imageLink.value, language.value, link.value, pages.value, title.value, year.value);

            if (!konyvek.includes(newBook)) {
                konyvek.push(newBook);
                createCards();
            }
        }
        
        function removeBook() {
            var book = document.getElementById(event.target.id);
            konyvek.forEach(konyv => {
                if (konyv.id != null) {
                    if (book.id == konyv.id) {
                        delete konyvek[konyvek.indexOf(konyv)];
                        bookCount--;
                        createCards();
                        console.log(bookCount)
                    }
                } 
            });
        }

        function changeBook(id) {

        }


    </script>
    <style>
        .bg-color {
            background-color: #ffe6cc;
        }
    </style>
</head>

<body class="bg-color">
    <nav class="navbar navbar-expand-lg bg-secondary">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link text-warning" href="index.html">Főoldal</a>
                    </li>
                    <li class="nav-item">
                        <a onclick="addBook()" class="nav-link text-warning" href="#">Új könyv</a>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Keresés" aria-label="Search">
                    <button class="btn btn-outline-warning" type="button">Keresés</button>
                </form>
            </div>
        </div>
    </nav>

    <br>

    <div class="container">
        <div id="card-list" class="row row-cols-1 row-cols-md-3 g-4"></div>
        <br>
    </div>
    </div>
</body>

</html>